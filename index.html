<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
<html>
    <head>
		<link rel="stylesheet" type="text/css" href="index.css">
    </head>
    <body>
        <div id="container">
            <canvas id="constellationCanvas" width="1000" height="1000" style="top:0svh; left:0svh"></canvas>
            <audio id="rewriteTheStarsAudio">
                <source src="chorus.mp3" type="audio/mpeg">
            </audio>
            <div id="text">
                <h1>It feels impossible</h1>
                <h2 onclick="itsPossible()"">Say that it's possible?</h2>
            </div>
        </div>
    </body>
</html>

<script>
function s(q){return document.querySelectorAll(q)}

function getStarHtml(maxSize, top=undefined, left=undefined, useMaxSize=false){
    if(top!==undefined){top-=1.7}
    if(left!==undefined){left-=2}
    var rand = useMaxSize ? 0 : Math.random();
    var size = useMaxSize ? maxSize : Math.ceil(rand*maxSize); //in px
    if(rand < 0.3){
        var speed = '0.1'
    } else if (rand > 0.6){
        var speed = '0.15'
    } else {
        var speed = '0.25'
    }
    //var animDur = Math.ceil(1/(size/maxSize) * 25)//smaller stars should move slower, so the higher size is the faster the animation needs to be
    return `
        <div class="star-container `+(useMaxSize===false ? '' : 'tiAmoStar')+
        `" data-speed="`+speed+`" `+
        (useMaxSize===false ? '' : 'data-og-top="'+top+'svh" data-og-left="'+left+'svw"')+` style="
            width: `+size+`px; 
            top: ` +(top ===undefined ? Math.floor(Math.random()*100) : top )+`svh; 
            left: `+(left===undefined ? Math.floor(Math.random()*100) : left)+`svw;">

            <div class="star"` +(useMaxSize===false ? `style="animation-delay: `+Math.floor(Math.random()*3000)+`ms"` : `` )+`></div>
        </div>
    `;
}
var html=""
for(var i=0; i<100; i++) {
    html+=getStarHtml(8)
}
s("#container")[0].innerHTML+=html;
spawnTiAmoStars()

var speedingUp = false;
var speedUpCtr = 0;
const speedUpLimit = 40;
const speedMod = 0.1;
var windingDown = false;
var addSpeed = 0;
var stopStarsMove = false;

function animateStars(){
    if(stopStarsMove){
        return;
    }
    if(speedingUp){
        if(speedUpCtr++ >= speedUpLimit){
            speedingUp = false
            setTimeout(() => {
                windingDown=true;
            }, 2000); 
        } else {
            addSpeed = addSpeed*1+speedMod
        }
    }
    if(windingDown){
        stopStarsMove=true;
        drawTiAmo();
        return;
    }

    s(".star-container").forEach(div=>{
        let currentX = div.style.left;
        currentX = currentX.substr(0, currentX.length-3)
        let currentY = div.style.top;
        currentY = currentY.substr(0, currentY.length-3)

        let speed = Math.max((div.dataset.speed*1+addSpeed*1), 0);

        let newX = currentX - speed;
        if (newX < 0) {
            newX = 100;
        }
        let newY = currentY - speed;
        if (newY < 0) {
            newY = 100;
        }
        div.style.left = newX + "svw"; 
        div.style.top  = newY + "svh"; 
    });

    s("#constellationCanvas").forEach(div=>{
        let currentX = div.style.left;
        currentX = currentX.substr(0, currentX.length-3)
        let currentY = div.style.top;
        currentY = currentY.substr(0, currentY.length-3)

        let speed = 0//0.1

        let newX = currentX - speed;
        if (newX < 0) {
            newX = 100;
        }
        let newY = currentY - speed;
        if (newY < 0) {
            newY = 100;
        }
        div.style.left = newX + "svw"; 
        div.style.top  = newY + "svh"; 
    });
    requestAnimationFrame(animateStars); // Keep the animation running
}

function spawnTiAmoStars(){
    var html = "";
    const size = 17
    //T
    html+=getStarHtml(size, 25, 28, true)
    html+=getStarHtml(size, 25, 48, true)
    html+=getStarHtml(size, 25, 38, true)
    html+=getStarHtml(size, 40, 38, true)
    //i
    html+=getStarHtml(size, 33, 61, true);
    html+=getStarHtml(size, 40, 61, true);
    html+=getStarHtml(size, 25, 61, true);
    //A
    html+=getStarHtml(size, 70, 15, true);
    html+=getStarHtml(size, 50, 25, true);
    html+=getStarHtml(size, 70, 35, true);
    html+=getStarHtml(size, 60, 20, true);
    html+=getStarHtml(size, 60, 30, true);
    //m
    html+=getStarHtml(size, 70, 42, true);
    html+=getStarHtml(size, 60, 42, true);
    html+=getStarHtml(size, 65, 50, true);
    html+=getStarHtml(size, 60, 58, true);
    html+=getStarHtml(size, 70, 58, true);
    //o
    html+=getStarHtml(size, 65, 67.5, true);
    html+=getStarHtml(size, 60, 72.5, true);
    html+=getStarHtml(size, 65, 77.5, true);
    html+=getStarHtml(size, 70, 72.5, true);

    s("#container")[0].innerHTML+=html;
}


function drawHLine(ctx, curr, toX, step, callback){
    ctx.beginPath();
    ctx.moveTo(curr.x, curr.y);
    curr.x+=step;
    ctx.lineTo(curr.x, curr.y);
    ctx.stroke();
    if(curr.x >= toX){
        callback();
    } else {
        requestAnimationFrame(()=>{drawHLine(ctx, curr, toX, step, callback)})
    }
}
function drawVLine(ctx, curr, toY, step, callback){
    ctx.beginPath();
    ctx.moveTo(curr.x, curr.y);
    curr.y+=step;
    ctx.lineTo(curr.x, curr.y);
    ctx.stroke();
    if(curr.y >= toY){
        callback();
    } else {
        requestAnimationFrame(()=>{drawHLine(ctx, curr, toY, step, callback)})
    }
}

function drawTiAmo(){
    s(".tiAmoStar").forEach(div => {
        div.style.visibility = 'visible'
        div.style.top  = div.dataset.ogTop 
        div.style.left = div.dataset.ogLeft
    })

    var ctx = s("#constellationCanvas")[0].getContext("2d")
    ctx.strokeStyle = "white";
    ctx.lineWidth = 5;
    ctx.beginPath();
    //T
    ctx.moveTo(280, 250);
    ctx.lineTo(480, 250);
    ctx.moveTo(380, 250);
    ctx.lineTo(380, 400);
    //i
    ctx.moveTo(610, 330);
    ctx.lineTo(610, 400);
    //A
    ctx.moveTo(150, 700);
    ctx.lineTo(250, 500);
    ctx.lineTo(350, 700);
    ctx.moveTo(200, 600);
    ctx.lineTo(300, 600);
    //m
    ctx.moveTo(420, 700);
    ctx.lineTo(420, 600);
    ctx.lineTo(500, 650);
    ctx.lineTo(580, 600);
    ctx.lineTo(580, 700);
    //o
    ctx.moveTo(675, 650);
    ctx.lineTo(725, 600);
    ctx.lineTo(775, 650);
    ctx.lineTo(725, 700);
    ctx.lineTo(675, 650);
    ctx.stroke();
}

requestAnimationFrame(animateStars);

function itsPossible(){
    //s("#rewriteTheStarsAudio")[0].play()
    s("#text")[0].style.animation="disappear 1s linear forwards"
    setTimeout(() => {
        speedingUp = true
    }, 1200);
}

</script>