<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
<html>
    <head>
		<link rel="stylesheet" type="text/css" href="index.css">
    </head>
    <body>
        <div id="container">
            <canvas id="constellationCanvas" width="1000" height="1000"></canvas>
            <audio id="rewriteTheStarsAudio">
                <source src="chorus.mp3" type="audio/mpeg">
            </audio>
            <div id="text">
                <h1>It feels impossible</h1>
                <h2 onclick="itsPossible()"">Say that it's possible?</h2>
            </div>
        </div>
    </body>
</html>

<script>
function s(q){return document.querySelectorAll(q)}

function getStarHtml(maxSize, top=undefined, left=undefined){
    var rand = Math.random();
    var size = Math.ceil(rand*maxSize); //in px
    if(rand < 0.3){
        var speed = '0.1'
    } else if (rand > 0.6){
        var speed = '0.15'
    } else {
        var speed = '0.25'
    }
    //var animDur = Math.ceil(1/(size/maxSize) * 25)//smaller stars should move slower, so the higher size is the faster the animation needs to be
    return `
        <div class="star-container" data-speed="`+speed+`" style="
            width: `+size+`px; 
            top: ` +(top ===undefined ? Math.floor(Math.random()*100) : top )+`svh; 
            left: `+(left===undefined ? Math.floor(Math.random()*100) : left)+`svw;">

            <div class="star" style="
                filter: blur(`+((Math.floor(Math.random()*4))+2)+`px); 
                animation-delay: `+Math.floor(Math.random()*3000)+`ms"></div>
        </div>
    `;
}
var html=""
for(var i=0; i<100; i++) {
    html+=getStarHtml(10)
}
s("#container")[0].innerHTML+=html;

var speedUpCtr = 0;
const speedUpLimit = 5;
function speedUpAnim(){
    if(speedUpCtr++ >= speedUpLimit){
        return
    }
    addSpeed = addSpeed*1+0.2
    setTimeout(speedUpAnim, 300);
}

var addSpeed = 0;
function animateStars(){
    s(".star-container").forEach(div=>{
        let currentX = div.style.left;
        currentX = currentX.substr(0, currentX.length-3)
        let currentY = div.style.top;
        currentY = currentY.substr(0, currentY.length-3)

        let speed = (div.dataset.speed*1+addSpeed*1);

        let newX = currentX - speed;
        if (newX < 0) {
            newX = 100;
        }
        let newY = currentY - speed;
        if (newY < 0) {
            newY = 100;
        }
        div.style.left = newX + "svw"; 
        div.style.top  = newY + "svh"; 
    });
    requestAnimationFrame(animateStars); // Keep the animation running
}

requestAnimationFrame(animateStars);

function itsPossible(){
    s("#text")[0].style.animation="disappear 1s linear forwards"
    //s("#rewriteTheStarsAudio")[0].play()
    speedUpAnim()

    var ctx = s("#constellationCanvas")[0].getContext("2d")
    ctx.strokeStyle = "white";
    ctx.lineWidth = 5;
    ctx.beginPath();
    //T
    ctx.moveTo(280, 250);
    ctx.lineTo(480, 250);
    ctx.moveTo(380, 250);
    ctx.lineTo(380, 400);
    //i
    ctx.moveTo(610, 330);
    ctx.lineTo(610, 400);
    //A
    ctx.moveTo(150, 700);
    ctx.lineTo(250, 500);
    ctx.lineTo(350, 700);
    ctx.moveTo(200, 600);
    ctx.lineTo(300, 600);
    //m
    ctx.moveTo(420, 700);
    ctx.lineTo(420, 600);
    ctx.lineTo(500, 650);
    ctx.lineTo(580, 600);
    ctx.lineTo(580, 700);
    //o
    ctx.moveTo(675, 650);
    ctx.lineTo(725, 600);
    ctx.lineTo(775, 650);
    ctx.lineTo(725, 700);
    ctx.lineTo(675, 650);
    ctx.stroke();
}

</script>